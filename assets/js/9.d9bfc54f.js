(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{406:function(s,a,t){"use strict";t.r(a);var e=t(56),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql调优"}},[s._v("#")]),s._v(" Mysql调优")]),s._v(" "),t("h2",{attrs:{id:"_1-连接线程缓存thread-cache-size"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-连接线程缓存thread-cache-size"}},[s._v("#")]),s._v(" 1. 连接线程缓存thread_cache_size")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://qastack.cn/server/408845/what-value-of-thread-cache-size-should-i-use",target:"_blank",rel:"noopener noreferrer"}},[s._v("调优方法"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("查询")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'thread_cache_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\nSHOW GLOBAL STATUS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Connections'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSHOW GLOBAL STATUS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Threads_created'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSHOW GLOBAL STATUS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Max_used_connections'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("修改")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("thread_cache_size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、编辑/etc/my.cnf 更改/添加\nthread_concurrency "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n")])])]),t("p",[s._v("Thread Cache 命中率：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Thread_Cache_Hit = (Connections - Threads_created) / Connections * 100%;\n")])])]),t("p",[s._v("一般在系统稳定运行一段时间后，Thread Cache命中率应该保持在90%左右才算正常。")]),s._v(" "),t("h2",{attrs:{id:"_2-表定义信息缓存table-definition-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-表定义信息缓存table-definition-cache"}},[s._v("#")]),s._v(" 2. 表定义信息缓存table_definition_cache")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/424477364",target:"_blank",rel:"noopener noreferrer"}},[s._v("相关文章"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("为了不让 TDC 带来的好处消失, 我们建议始终保持状态 "),t("code",[s._v("Opened_table_definitions")]),s._v("小于参数"),t("code",[s._v("table_definition_cache")]),s._v(", 这样就能保证 TDC 始终命中。")]),s._v(" "),t("p",[s._v("相关查询如下")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show global status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Opened_table_definitions'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Opened_table_definitions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("378")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_definition_cache'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" table_definition_cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("可以看到 "),t("code",[s._v("Opened_table_definitions")]),s._v("为378，小于参数"),t("code",[s._v("table_definition_cache")]),s._v("定义的2000")]),s._v(" "),t("h2",{attrs:{id:"_3-最大连接数max-connections"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-最大连接数max-connections"}},[s._v("#")]),s._v(" 3. 最大连接数max_connections")]),s._v(" "),t("blockquote",[t("p",[s._v("max_used_connections / max_connections * 100% （理想值≈ 85%）")])]),s._v(" "),t("p",[s._v("如果max_used_connections跟max_connections相同 那么就是max_connections设置过低或者超过服务器负载上限了，低于10%则设置过大。")]),s._v(" "),t("p",[s._v("查询")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max_connections'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" max_connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SHOW GLOBAL STATUS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Max_used_connections'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+----------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Max_used_connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("313")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("比率为31.3%，符合要求")]),s._v(" "),t("h2",{attrs:{id:"_4-临时表使用内存tmp-table-size"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-临时表使用内存tmp-table-size"}},[s._v("#")]),s._v(" 4. 临时表使用内存tmp_table_size")]),s._v(" "),t("p",[s._v("定义"),t("code",[s._v("MEMORY")]),s._v("存储引擎创建的内部内存临时表的最大大小，比较理想的配置是：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Created_tmp_disk_tables / Created_tmp_tables * 100% <= 25%\n")])])]),t("p",[s._v("查询")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show global status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'created_tmp%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Created_tmp_disk_tables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Created_tmp_files       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Created_tmp_tables      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("993")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("磁盘创建的临时表为0，为最优")]),s._v(" "),t("h2",{attrs:{id:"_5-慢查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-慢查询"}},[s._v("#")]),s._v(" 5. 慢查询")]),s._v(" "),t("p",[s._v("慢查询默认为关闭状态")]),s._v(" "),t("p",[s._v("开启和查询状态")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow_query%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------+------------------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+------------------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON                                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /var/lib/mysql/ecs-gacbd-interface-02-slow.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+------------------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"_6-innodb数据和索引缓存innodb-buffer-pool-size"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-innodb数据和索引缓存innodb-buffer-pool-size"}},[s._v("#")]),s._v(" 6 innodb数据和索引缓存innodb_buffer_pool_size")]),s._v(" "),t("p",[s._v("查询状态")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_buffer_pool_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("计算命中率")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_buffer_pool_read%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("命中率为"),t("code",[s._v("innodb_buffer_pool_read_requests / (innodb_buffer_pool_read_requests + innodb_buffer_pool_reads ) * 100%")]),s._v("，若此值小于99%，考虑增大缓存")]),s._v(" "),t("h2",{attrs:{id:"_7-二进制日志缓存binlog-cache-size"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-二进制日志缓存binlog-cache-size"}},[s._v("#")]),s._v(" 7 二进制日志缓存binlog_cache_size")]),s._v(" "),t("p",[s._v("查询")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_cache_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("计算命中率")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show global status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_cache_%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("命中率为"),t("code",[s._v("Binlog_cache_use / (Binlog_cache_use + Binlog_cache_disk_use ) * 100%")]),s._v("，若此值小于99%，考虑增大缓存")]),s._v(" "),t("h2",{attrs:{id:"_8-表缓存table-open-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-表缓存table-open-cache"}},[s._v("#")]),s._v(" 8 表缓存table_open_cache")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("属性")]),s._v(" "),t("th",[s._v("值")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("2000")])]),s._v(" "),t("tr",[t("td",[s._v("最小值")]),s._v(" "),t("td",[s._v("1")])]),s._v(" "),t("tr",[t("td",[s._v("最大值")]),s._v(" "),t("td",[s._v("524288")])])])]),s._v(" "),t("p",[s._v("查询")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_open_cache'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("计算是否需要增加")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("SHOW GLOBAL STATUS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Open%tables'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("如果"),t("code",[s._v("Open_tables")]),s._v("的值等于"),t("code",[s._v("table_open_cache")]),s._v("，且"),t("code",[s._v("Opened_tables")]),s._v("远远大于"),t("code",[s._v("table_open_cache")]),s._v("，说明表缓存池快要满了 但 "),t("code",[s._v("Opened_tables")]),s._v(" 还在一直有新的增长 这说明你还有很多未被缓存的表，这时可以适当增加 "),t("code",[s._v("table_open_cache")]),s._v(" 的大小。")]),s._v(" "),t("p",[s._v("比较适合的值：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Open_tables / Opened_tables >= 0.85\nOpen_tables / table_open_cache <= 0.95\n")])])]),t("p",[s._v("hit rate计算公式")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hit rate = table_open_cache * 100 / Opened_tables = 0.5\n")])])]),t("p",[s._v("hit rate 为 0.5 或 1.0 较好")]),s._v(" "),t("p",[s._v("设置")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global table_open_cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" （立即生效重启后失效）\n\nMySQL 配置文件 my.cnf 中 mysqld 下添加 table_open_cache\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntable_open_cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);