(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{413:function(t,s,e){"use strict";e.r(s);var a=e(56),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"mysql-binlog"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-binlog"}},[t._v("#")]),t._v(" mysql binlog")]),t._v(" "),e("h2",{attrs:{id:"_1-mysqlbinlog命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-mysqlbinlog命令"}},[t._v("#")]),t._v(" 1. mysqlbinlog命令")]),t._v(" "),e("p",[t._v("常用使用方法，使用管道符输出为sql文件")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("mysqlbinlog -vv --base64-output"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("decode-rows --database"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("test "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".sql\n")])])]),e("p",[t._v("常用参数解释")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html#option_mysqlbinlog_verbose",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("--verbose")]),e("OutboundLink")],1),t._v(", "),e("code",[t._v("-v")])])]),t._v(" "),e("p",[t._v("从行格式中重建伪SQL(带注释)，不显示 binlog_rows_query_log_events 参数效果：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("-vv")]),t._v(", "),e("code",[t._v("--verbose --verbose")])])]),t._v(" "),e("p",[t._v("从行格式中重建伪SQL并添加字段数据类型的注释，可以显示 binlog_rows_query_log_events 参数效果，区别在于，-v不会显示具体的字段类型，比如"),e("code",[t._v("-v")]),t._v("不会显示具体的update sql，"),e("code",[t._v("-vv")]),t._v("就会显示具体的update sql")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("--base64-output=decode-rows")])])]),t._v(" "),e("p",[t._v("不显示行格式，如果同时加 -v 参数，可以从行格式中解码为带注释的伪SQL：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mysqlbinlog -v --base64-output"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("DECODE-ROWS log_file\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# at 218")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#080828 15:03:08 server id 1  end_log_pos 258   Write_rows: table id 17 flags: STMT_END_F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### INSERT INTO test.t")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### SET")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @1=1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @2='apple'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @3=NULL")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# at 302")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#080828 15:03:08 server id 1  end_log_pos 356   Update_rows: table id 17 flags: STMT_END_F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### UPDATE test.t")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### WHERE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @1=1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @2='apple'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @3=NULL")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### SET")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @1=1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @2='pear'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @3='2009:01:01'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# at 400")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#080828 15:03:08 server id 1  end_log_pos 442   Delete_rows: table id 17 flags: STMT_END_F")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### DELETE FROM test.t")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### WHERE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @1=1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @2='pear'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###   @3='2009:01:01'")]),t._v("\n")])])]),e("p",[t._v("如果把上面的"),e("code",[t._v("-v")]),t._v("改为"),e("code",[t._v("-vv")]),t._v("，就可以获取具体的"),e("code",[t._v("update sql")])]),t._v(" "),e("h2",{attrs:{id:"_2-如何定位binlog文件并输出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何定位binlog文件并输出"}},[t._v("#")]),t._v(" 2. 如何定位binlog文件并输出")]),t._v(" "),e("p",[t._v("执行sql，从"),e("code",[t._v("File")]),t._v("字段获取binlog名字")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" master "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("在mysql所在服务器全局搜索该文件名称")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" / -name "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("文件名"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("找到文件位置后，使用"),e("code",[t._v("mysqlbinlog")]),t._v("命令导出为sql，如")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("mysqlbinlog --no-defaults -vv --base64-output"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("decode-rows --database"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("数据库名"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("binlog文件名"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/temp/binlog.sql\n")])])]),e("h2",{attrs:{id:"_3-常见问题处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-常见问题处理"}},[t._v("#")]),t._v(" 3. 常见问题处理")]),t._v(" "),e("p",[t._v("注意，使用mysqlbinlog命令时如果出现错误如下")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("mysqlbinlog: unknown variable "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default_character_set=utf8mb4'")]),t._v("\n")])])]),e("p",[t._v("需要在"),e("code",[t._v("mysqlbinlog")]),t._v("命令之后第一个指定"),e("code",[t._v("--no-defaults")])]),t._v(" "),e("p",[t._v("参数释义如下：")]),t._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html#option_mysqlbinlog_no-defaults",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("--no-defaults")]),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("Do not read any option files. If program startup fails due to reading unknown options from an option file, "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html#option_mysqlbinlog_no-defaults",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("--no-defaults")]),e("OutboundLink")],1),t._v(" can be used to prevent them from being read.")]),t._v(" "),e("p",[t._v("The exception is that the "),e("code",[t._v(".mylogin.cnf")]),t._v(" file is read in all cases, if it exists. This permits passwords to be specified in a safer way than on the command line even when "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html#option_mysqlbinlog_no-defaults",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("--no-defaults")]),e("OutboundLink")],1),t._v(" is used. To create "),e("code",[t._v(".mylogin.cnf")]),t._v(", use the "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("mysql_config_editor")]),e("OutboundLink")],1),t._v(" utility. See "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Section 4.6.6, “mysql_config_editor — MySQL Configuration Utility”"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("For additional information about this and other option-file options, see "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/option-file-options.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Section 4.2.2.3, “Command-Line Options that Affect Option-File Handling”"),e("OutboundLink")],1),t._v(".")])])]),t._v(" "),e("p",[t._v("要注意，执行mysqlbinlog命令最好在mysql所在的机子上执行，避免"),e("code",[t._v("mysqlbinlog")]),t._v("版本本机与服务器上不统一的情况，可能会有如下报错")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("ERROR: Could not "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" entry at offset "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(": Error "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" log "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v(" or "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" error "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".\nERROR: Found invalid event "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" binary log\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);